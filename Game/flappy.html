<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flappy Bird</title>
<style>
body {
  margin:0;
  background:#70c5ce;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  height:100vh;
  font-family:sans-serif;
  color:#fff;
}
canvas { background:#70c5ce; display:block; margin-bottom:10px; touch-action:none; }
#scoreboard { font-size:1.2em; margin-bottom:10px; }
button {
  margin:5px;
  padding:10px 20px;
  font-size:1em;
  cursor:pointer;
  background:#444;
  color:#fff;
  border:none;
  border-radius:5px;
}
button:hover { background:#666; }
#overlay {
  position:absolute;
  top:0; left:0;
  width:100%;
  height:100%;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  background:rgba(0,0,0,0.7);
  z-index:10;
}
</style>
</head>
<body>

<div id="scoreboard">Score: 0 | High Score: 0</div>
<canvas id="game" width="400" height="600"></canvas>

<div id="overlay">
  <button id="playBtn">Play</button>
</div>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const scoreboard = document.getElementById('scoreboard');
const overlay = document.getElementById('overlay');
const playBtn = document.getElementById('playBtn');

let bird, pipes, frame, score, highScore, gameInterval;

highScore = localStorage.getItem('flappyHighScore') || 0;

function updateScore() {
  scoreboard.textContent = `Score: ${score} | High Score: ${highScore}`;
}

function startGame() {
  bird = { x: 50, y: 300, vy: 0 };
  pipes = [];
  frame = 0;
  score = 0;
  overlay.style.display = 'none';
  updateScore();
  if(gameInterval) clearInterval(gameInterval);
  gameInterval = setInterval(loop, 20);
}

function gameOver() {
  if(score > highScore){
    highScore = score;
    localStorage.setItem('flappyHighScore', highScore);
  }
  updateScore();
  clearInterval(gameInterval);

  overlay.innerHTML = `
    <button onclick="window.location.href='homegame.html'">Back</button>
    <button id="playAgain">Play Again</button>
  `;
  overlay.style.display = 'flex';

  document.getElementById('playAgain').addEventListener('click', ()=>{
    overlay.innerHTML = `<button id="playBtn">Play</button>`;
    overlay.style.display = 'flex';
    document.getElementById('playBtn').addEventListener('click', startGame);
  });
}

function loop() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Physics
  bird.vy += 0.5;
  bird.y += bird.vy;

  // Check collision with top/bottom
  if(bird.y < 0 || bird.y + 20 > canvas.height) {
    gameOver();
    return; // langsung berhenti
  }

  // Draw bird
  ctx.fillStyle='yellow';
  ctx.fillRect(bird.x,bird.y,20,20);

  // Pipes
  if(frame % 90 === 0){
    const h = Math.random()*300 + 50;
    pipes.push({x:canvas.width, y:h});
  }
  ctx.fillStyle='green';
  pipes.forEach(p=>{
    p.x -= 2;
    ctx.fillRect(p.x,0,50,p.y);
    ctx.fillRect(p.x,p.y+150,50,canvas.height);

    // Collision with pipes
    if(bird.x < p.x+50 && bird.x+20>p.x && (bird.y<p.y || bird.y+20>p.y+150)){
      gameOver();
    }
    if(p.x+50 === bird.x) score++;
  });

  updateScore();
  frame++;
}

// Controls PC
document.addEventListener('keydown', ()=>{ bird.vy = -8; });

// Touch controls mobile
canvas.addEventListener('touchstart', ()=>{ bird.vy = -8; }, {passive:true});

playBtn.addEventListener('click', startGame);

updateScore();
</script>

</body>
</html>
